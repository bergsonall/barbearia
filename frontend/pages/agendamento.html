<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - Ramos Barbearia</title>

    <!-- CSS principal do projeto -->
    <link rel="stylesheet" href="../assets/style/style.css">
</head>

<body>

    <!-- HEADER / NAVBAR -->
    <header>
        <nav id="navbar">
            <img src="../assets/img/logo.png" alt="Ramos Barbearia" class="logo-nav">

            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../index.html#servicos">Serviços</a></li>
            </ul>

            <a href="../index.html" class="cta-agendar">Voltar</a>
        </nav>
    </header>

    <!-- CONTEÚDO PRINCIPAL -->
    <main>
        <div class="form-wrapper">
            <h1>Agendamento pelo site</h1>
            <p>Preencha o formulário abaixo para solicitar seu horário.</p>

            <!-- FORMULÁRIO DE AGENDAMENTO -->
            <!-- Nome -->
            <form id="form-agendamento">

                <div class="form-group">
                    <label for="nome">Nome completo</label>
                    <input id="nome" name="nome" type="text" required>
                </div>

                <div class="form-group">
                    <label for="telefone">Telefone</label>
                    <input id="telefone" name="telefone" type="tel" required>
                </div>

                <div class="form-group">
                    <label for="servico">Serviço</label>
                    <select id="servico" name="servico">
                        <option>Corte Clássico</option>
                        <option>Barba Terapia</option>
                        <option>Combo Ramos</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="data">Data desejada</label>
                    <input id="data" name="data" type="date" required>
                </div>

                <div class="form-group">
                    <label for="hora">Hora</label>
                    <input id="hora" name="hora" type="time" required>
                </div>

                <div class="form-actions">
                    <button type="submit" class="cta-agendar">
                        Enviar solicitação
                    </button>
                </div>
            </form>
        </div>
        <!-- WhatsApp -->
        <p style="margin-top:20px;">
            Ou
            <a href="https://wa.me/5132472310?text=Olá! Gostaria de agendar um horário na Ramos Barbearia."
                class="btn-whatsapp" target="_blank">
                Agendar via WhatsApp
            </a>
        </p>

    </main>

    <!-- FOOTER -->
    <footer style="padding:20px;text-align:center;border-top:1px solid #222;">
        <p>&copy; 2024 Ramos Barbearia - Todos os direitos reservados.</p>
    </footer>

    <!-- SCRIPT DE AGENDAMENTO -->
    <script>
        /**
         * Verifica se o usuário está logado
         * Se não estiver, redireciona para login
         */
        const token = localStorage.getItem('token');

        if (!token) {
            window.location.href = '../login.html?next=pages/agendamento.html';
        }

        /**
         * Envio do formulário
         */
        document.getElementById('form-agendamento').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Captura dos dados
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const id_servico = document.getElementById('servico').value;
            const data = document.getElementById('data').value;
            const hora = document.getElementById('hora').value;

            // Validações básicas
            if (!nome || !telefone || !id_servico || !data || !hora) {
                alert('Preencha todos os campos.');
                return;
            }

            try {
                // Envio para o backend
                const response = await fetch('http://localhost:3000/agendamentos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        nome,
                        telefone,
                        id_servico,
                        data,
                        hora
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Agendamento realizado com sucesso!');
                    document.getElementById('form-agendamento').reset();
                } else {
                    alert(result.erro || 'Erro ao realizar agendamento.');
                }

            } catch (error) {
                alert('Erro de conexão com o servidor.');
                console.error(error);
            }
        });
    </script>

</body>

</html>